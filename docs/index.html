<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Space Exploration Tactics – Promo & Demo Flow</title>
    <meta name="description" content="A tactical, narrative-driven space exploration game. Explore the void, make consequential choices, and fight to uncover the Prometheus truth." />
    <style>
      :root {
        --bg: #0a0d12;
        --panel: #111622;
        --text: #e8eefc;
        --muted: #a8b3d1;
        --accent: #7bd8ff;
        --accent-2: #b47bff;
      }
      * { box-sizing: border-box; }
      html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Inter, Arial, sans-serif; }
      a { color: var(--accent); text-decoration: none; }
      a:hover { text-decoration: underline; }

      .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
      header.hero { display: grid; grid-template-columns: 1.2fr 1fr; gap: 24px; align-items: center; padding: 40px 0 8px; }
      header.hero .copy h1 { margin: 0 0 10px; font-size: 44px; line-height: 1.05; letter-spacing: 0.3px; }
      header.hero .copy p { margin: 0 0 16px; color: var(--muted); font-size: 18px; }
      header.hero .cta { display: flex; gap: 12px; margin-top: 18px; }
      .btn { display: inline-block; padding: 12px 16px; border-radius: 10px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #0b0e14; font-weight: 700; }
      .btn.secondary { background: #1a2233; color: var(--text); border: 1px solid #263252; }

      .panel { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); border: 1px solid #1b2438; border-radius: 14px; padding: 18px; }
      .section { margin: 28px 0; }
      .section h2 { margin: 0 0 10px; font-size: 26px; letter-spacing: 0.2px; }
      .section p.lead { margin: 0 0 16px; color: var(--muted); }

      .feature-list { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 14px; }
      .feature { padding: 14px; border-radius: 12px; background: #0e1421; border: 1px solid #1a2236; }
      .feature h3 { margin: 0 0 6px; font-size: 18px; }
      .feature p { margin: 0; color: var(--muted); font-size: 14px; }

      .grid { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 8px; }
      .grid.grid-4 { grid-template-columns: repeat(4, minmax(0,1fr)); }
      .grid img { width: 100%; height: 100%; object-fit: cover; display: block; border-radius: 10px; border: 1px solid #1b2438; }

      .acts { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 14px; }
      .act { background: #0e1421; border: 1px solid #1a2236; border-radius: 12px; padding: 14px; }
      .act h3 { margin: 0 0 8px; font-size: 18px; }
      .act ul { margin: 0; padding-left: 18px; color: var(--muted); }
      .act li { margin: 6px 0; }

      .flow { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
      .flow .lane { grid-column: 1 / -1; }
      .lane h3 { margin: 8px 0 8px; font-size: 18px; letter-spacing: 0.2px; }
      .lane .shots { display: grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap: 8px; }
      .shot { position: relative; border-radius: 10px; overflow: hidden; border: 1px solid #1b2438; }
      .shot img { width: 100%; height: 100%; object-fit: cover; display: block; }
      .shot .cap { position: absolute; left: 8px; bottom: 8px; background: rgba(9,12,18,0.7); padding: 4px 6px; border-radius: 6px; font-size: 12px; color: var(--text); border: 1px solid rgba(123,216,255,0.25); }

      footer { color: var(--muted); border-top: 1px solid #1b2438; margin-top: 24px; padding: 18px 0 30px; text-align: center; font-size: 13px; }

      .hero-img { border-radius: 12px; overflow: hidden; border: 1px solid #1b2438; }
      .hero-img img { width: 100%; height: auto; display: block; }

      @media (max-width: 980px) {
        header.hero { grid-template-columns: 1fr; }
        .feature-list, .acts, .grid { grid-template-columns: 1fr; }
        .lane .shots { grid-template-columns: repeat(2, minmax(0,1fr)); }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header class="hero">
        <div class="copy">
          <h1>Space Exploration Tactics</h1>
          <p>Lead a crew beyond known space in a tactical, narrative-driven journey. Make hard choices, survive alien ruins, and confront the Prometheus truth at the edge of the void.</p>
          <div class="cta">
            <a class="btn" href="#demo-flow">View Demo Flow</a>
            <a class="btn secondary" href="#gallery">See Gallery</a>
          </div>
        </div>
        <div class="hero-img">
          <img src="promo/020.png" alt="Hero key art – starship over alien world" />
        </div>
      </header>

      <section class="section">
        <div class="feature-list">
          <div class="feature">
            <h3>Branching Narrative</h3>
            <p>Acts and nodes structure choices with consequences across missions.</p>
          </div>
          <div class="feature">
            <h3>Tactical Encounters</h3>
            <p>Face pirates, beasts, and void guardians in turn-based fights.</p>
          </div>
          <div class="feature">
            <h3>Void-Bound Mysteries</h3>
            <p>Unlock Prometheus logs and bargain, resist, or submit to the void.</p>
          </div>
        </div>
      </section>

      <section class="section panel" id="acts">
        <h2>Narrative Overview</h2>
        <p class="lead">Based on the game acts and nodes, the journey unfolds across three escalating acts. See full outline in <a href="game_acts_and_nodes.md">game_acts_and_nodes.md</a>.</p>
        <div class="acts">
          <div class="act">
            <h3>Act 1 – Into the Unknown</h3>
            <ul>
              <li>Departure from Earth Command; chart a safe route or risk shortcuts.</li>
              <li>Salvage a derelict satellite tangled with crystalline void matter.</li>
              <li>Investigate a cosmic anomaly or heed its eerie echo.</li>
              <li>Survive a pirate ambush; fight, stall, or bargain.</li>
              <li>Make planetfall through stormy skies toward ancient ruins.</li>
            </ul>
          </div>
          <div class="act">
            <h3>Act 2 – Ruins of the Past</h3>
            <ul>
              <li>Scout alien ruins; study mysterious void glyphs or ignore the whispers.</li>
              <li>Beasts strike from shadows in tense tactical combat.</li>
              <li>Forked choice: rescue colonists or raid a supply vault.</li>
              <li>Face corruption whispers and choose who resists.</li>
              <li>Confront the Crystal Guardian—fight, negotiate, or submit.</li>
            </ul>
          </div>
          <div class="act">
            <h3>Act 3 – The Prometheus Truth</h3>
            <ul>
              <li>Navigate fractured space to reach the Prometheus wreck.</li>
              <li>With crew divided, parley with void-touched Watchers or engage.</li>
              <li>Recover Prometheus logs and decide the final approach.</li>
              <li>Endings: Fight the Void, Submit, or Bargain—each with consequences.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="gallery">
        <h2>Promo Gallery</h2>
        <p class="lead">Concepts and in-engine captures. Click any image to open a larger view and browse.</p>
        <div id="promoGrid" class="grid grid-4"></div>
        <!-- Lightbox Modal -->
        <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="Image viewer" style="display:none;">
          <button class="lb-close" aria-label="Close (Esc)">×</button>
          <button class="lb-prev" aria-label="Previous (←)">‹</button>
          <figure class="lb-figure">
            <img id="lbImage" alt="" />
            <figcaption id="lbCaption"></figcaption>
            <div id="lbDesc" class="lb-desc"></div>
          </figure>
          <button class="lb-next" aria-label="Next (→)">›</button>
        </div>
      </section>

      <section class="section panel" id="demo-flow">
        <h2>Demo Game Flow</h2>
        <p class="lead">A quick visual walkthrough of the demo beats. Screens are representative and may change.</p>
        <div class="flow">
          <div class="lane">
            <h3>Act 1 – Departure to Planetfall</h3>
            <div class="shots">
              <div class="shot"><img src="demogame/Act1-0.png" alt="Act 1 – Departure"><div class="cap">Departure</div></div>
              <div class="shot"><img src="demogame/Act1-1.png" alt="Act 1 – Derelict Satellite"><div class="cap">Derelict Satellite</div></div>
              <div class="shot"><img src="demogame/Act1-2.png" alt="Act 1 – Cosmic Anomaly"><div class="cap">Cosmic Anomaly</div></div>
              <div class="shot"><img src="demogame/Act1-5A.png" alt="Act 1 – Pirate Ambush"><div class="cap">Pirate Ambush</div></div>
              <div class="shot"><img src="demogame/Act1-6.png" alt="Act 1 – Planetfall"><div class="cap">Planetfall</div></div>
              <div class="shot"><img src="demogame/Act1-Final.png" alt="Act 1 – Jungle Ruins"><div class="cap">Jungle Ruins</div></div>
            </div>
          </div>
          <div class="lane">
            <h3>Act 2 – Ruins & Guardian</h3>
            <div class="shots">
              <div class="shot"><img src="demogame/Act2-1.png" alt="Act 2 – Landing Zone"><div class="cap">Landing Zone</div></div>
              <div class="shot"><img src="demogame/Act2-2.png" alt="Act 2 – Alien Glyphs"><div class="cap">Alien Glyphs</div></div>
              <div class="shot"><img src="demogame/Act2-3.png" alt="Act 2 – Beast Ambush"><div class="cap">Beast Ambush</div></div>
              <div class="shot"><img src="demogame/Act2-4.png" alt="Act 2 – Rescue or Raid"><div class="cap">Rescue or Raid</div></div>
              <div class="shot"><img src="demogame/Act2-6Fight.png" alt="Act 2 – Crystal Guardian Fight"><div class="cap">Crystal Guardian</div></div>
              <div class="shot"><img src="demogame/Act2-Final.png" alt="Act 2 – Collapse Escape"><div class="cap">Collapse Escape</div></div>
            </div>
          </div>
          <div class="lane">
            <h3>Act 3 – Prometheus & Endings</h3>
            <div class="shots">
              <div class="shot"><img src="demogame/Act3-1.png" alt="Act 3 – Fractured Space"><div class="cap">Fractured Space</div></div>
              <div class="shot"><img src="demogame/Act3-2.png" alt="Act 3 – Crew Fracture"><div class="cap">Crew Fracture</div></div>
              <div class="shot"><img src="demogame/Act3-3.png" alt="Act 3 – The Watchers"><div class="cap">The Watchers</div></div>
              <div class="shot"><img src="demogame/Act3-4.png" alt="Act 3 – Prometheus Logs"><div class="cap">Prometheus Logs</div></div>
              <div class="shot"><img src="demogame/Act3-5.png" alt="Act 3 – The Wreck"><div class="cap">The Wreck</div></div>
              <div class="shot"><img src="demogame/Act3-6A.png" alt="Ending – Fight the Void"><div class="cap">Fight the Void</div></div>
              <div class="shot"><img src="demogame/Act3-6B.png" alt="Ending – Submit to the Void"><div class="cap">Submit to the Void</div></div>
              <div class="shot"><img src="demogame/Act3-6C.png" alt="Ending – Bargain with the Void"><div class="cap">Bargain with the Void</div></div>
              <div class="shot"><img src="demogame/Act3-Final.png" alt="Act 3 – Final Outcome"><div class="cap">Final Outcome</div></div>
            </div>
          </div>
        </div>
      </section>

      <section class="section panel" id="dialogs">
        <h2>Dialog Player</h2>
        <p class="lead">Click through sample scenes from the demo. For deeper context on systems and branching, see the <a href="Space%20Exploration%20Game%20-%20Core%20Narrative%20%26%20Branching%20Quests.pdf" target="_blank" rel="noopener">Game Design Document (PDF)</a>.</p>

        <div class="feature" style="margin-bottom:12px;">
          <label for="sceneSelect" style="display:block; font-weight:600; margin-bottom:6px;">Select Scene</label>
          <select id="sceneSelect" style="width:100%; padding:10px; border-radius:8px; background:#0e1421; color:var(--text); border:1px solid #1a2236;"></select>
        </div>

        <div id="dialogBox" class="dialog-box" style="display:none;">
          <div class="dialog-header">
            <div class="speaker" id="dlgSpeaker">Speaker</div>
          </div>
          <div class="dialog-text" id="dlgText">…</div>
          <div class="choices" id="dlgChoices"></div>
          <div class="nav" id="dlgNav"></div>
        </div>
        <div id="dialogNotice" style="color:var(--muted); font-size:14px; margin-top:8px;"></div>
      </section>

      <!-- Baked-in dialogs.json for offline file access -->
      <script id="dialogs-data" type="application/json">
$(cat dialogs.json)
      </script>

      <script>
        // Gallery data and lightbox
        const galleryCount = 32;
        const galleryImages = Array.from({ length: galleryCount }, (_, i) => `promo/${String(i + 1).padStart(3, '0')}.png`);

        const demogameImages = [
          "demogame/Act1-0.png",
          "demogame/Act1-1.png",
          "demogame/Act1-2.png",
          "demogame/Act1-5A.png",
          "demogame/Act1-6.png",
          "demogame/Act1-Final.png",
          "demogame/Act2-1.png",
          "demogame/Act2-2.png",
          "demogame/Act2-3.png",
          "demogame/Act2-4.png",
          "demogame/Act2-6Fight.png",
          "demogame/Act2-Final.png",
          "demogame/Act3-1.png",
          "demogame/Act3-2.png",
          "demogame/Act3-3.png",
          "demogame/Act3-4.png",
          "demogame/Act3-5.png",
          "demogame/Act3-6A.png",
          "demogame/Act3-6B.png",
          "demogame/Act3-6C.png",
          "demogame/Act3-Final.png",
        ];

        const demogameNotes = {
          'Act1-0': '<strong>Act 1 – Entry: Departure</strong><br/>The crew launches from Earth Command toward the frontier.<br/><em>Choices:</em> Chart Safe Route · Risk Shortcuts',
          'Act1-1': '<strong>Act 1 – Event: Derelict Satellite</strong><br/>A satellite tangled in crystalline void matter offers salvage.<br/><em>Choices:</em> Salvage Carefully (Engineering) · Force Salvage',
          'Act1-2': '<strong>Act 1 – Encounter: Cosmic Anomaly</strong><br/>A purple rift crackling with lightning distorts nearby stars.<br/><em>Choices:</em> Study Anomaly · Bypass · Void Touched: Listen to the Echo',
          'Act1-5A': '<strong>Act 1 – Combat: Pirate Ambush</strong><br/>Pirates with jury‑rigged alien hulls attack the ship.<br/><em>Choices:</em> Open Fire · Attempt Diplomacy · Bribe · Stall',
          'Act1-6': '<strong>Act 1 – Climax: Planetfall</strong><br/>Descend through a stormy alien atmosphere toward jungle ruins.<br/><em>Choices:</em> Prepare Landing Party',
          'Act1-Final': '<strong>Act 1 – Planetfall Achieved</strong><br/>Touchdown near ancient ruins; the ground mission begins.',
          'Act2-1': '<strong>Act 2 – Entry: Landing Zone</strong><br/>Stormy jungles and alien ruins surround the LZ.<br/><em>Choices:</em> Scout Perimeter · Enter Ruins Directly',
          'Act2-2': '<strong>Act 2 – Event: Alien Glyphs</strong><br/>Faint void glyphs glow on broken walls inside the ruin.<br/><em>Choices:</em> Study Glyphs (Intellect) · Ignore · Void Touched: Listen',
          'Act2-3': '<strong>Act 2 – Combat: Beast Ambush</strong><br/>Twisted alien beasts leap from the shadows among the ruins.<br/><em>Encounter:</em> Tactical combat',
          'Act2-4': '<strong>Act 2 – Fork: Rescue or Raid</strong><br/>A cavern splits—colonists trapped under rubble vs. a supply vault.<br/><em>Choices:</em> Rescue Colonists (Athletics) · Raid Vault',
          'Act2-6Fight': '<strong>Act 2 – Climax: Crystal Guardian</strong><br/>A massive guardian blocks the path to the beacon.<br/><em>Choices:</em> Fight · Negotiate (Diplomacy) · Void Touched: Submit',
          'Act2-Final': '<strong>Act 2 – Wrap‑Up: Collapse Escape</strong><br/>Run back to the ship as the ruins collapse.<br/>Debrief: Resources · Crew Status · Lore Unlocked',
          'Act3-1': '<strong>Act 3 – Entry: Fractured Space</strong><br/>Asteroids drift around a black void sphere.<br/><em>Choices:</em> Safe Approach · Direct Approach',
          'Act3-2': '<strong>Act 3 – Event: Crew Fracture</strong><br/>Infighting peaks; one crew member succumbs to whispers.<br/><em>Choices:</em> Restrain Them (Willpower) · Let Them Lead',
          'Act3-3': '<strong>Act 3 – Encounter: The Watchers</strong><br/>Void‑possessed ships block the path.<br/><em>Choices:</em> Fight · Negotiate · Void Touched: Merge Voices',
          'Act3-4': '<strong>Act 3 – Midpoint: Prometheus Logs</strong><br/>Data pods in a debris field reveal the Prometheus crew\'s fate.<br/><em>Choices:</em> Access Logs · Ignore',
          'Act3-5': '<strong>Act 3 – Final Approach: The Wreck</strong><br/>Prometheus wreck half‑consumed by a void rift.<br/><em>Choices:</em> Fight the Void · Submit · Negotiate',
          'Act3-6A': '<strong>Ending – Fight the Void</strong><br/>Tactical battle against the void‑corrupted Prometheus husk.',
          'Act3-6B': '<strong>Ending – Submit to the Void</strong><br/>Crew dissolves into the Choir of the Void.',
          'Act3-6C': '<strong>Ending – Bargain with the Void</strong><br/>Pact buys time but spreads corruption.',
          'Act3-Final': '<strong>Act 3 – Wrap‑Up: Debrief / Ending</strong><br/>Earth Command console summarizes the outcome.<br/><em>Endings:</em> Victory · Assimilation · Pact',
        };

        (function addLightboxStyles(){
          const css = `
          .lightbox{position:fixed;inset:0;background:rgba(5,8,13,0.92);display:flex;align-items:center;justify-content:center;gap:12px;z-index:50}
          .lightbox .lb-figure{margin:0;max-width:min(92vw,1280px);max-height:min(88vh,900px);display:flex;flex-direction:column;align-items:center}
          .lightbox img{max-width:100%;max-height:80vh;border-radius:8px;border:1px solid #24324f;box-shadow:0 10px 30px rgba(0,0,0,0.4)}
          .lightbox figcaption{color:#a8b3d1;margin-top:8px;font-size:13px}
          .lightbox .lb-desc{color:#cfd8ef;margin-top:6px;font-size:13px;max-width:70ch;text-align:center}
          .lightbox .lb-close,.lightbox .lb-prev,.lightbox .lb-next{position:absolute;background:#111a2c;color:#e8eefc;border:1px solid #263252;border-radius:10px;padding:8px 10px;cursor:pointer}
          .lightbox .lb-close{top:16px;right:16px;font-size:20px;line-height:1}
          .lightbox .lb-prev{left:16px}
          .lightbox .lb-next{right:16px}
          .grid img{cursor:pointer}
          .flow .shot img{cursor:pointer}
          `;
          const s=document.createElement('style');s.textContent=css;document.head.appendChild(s);
        })();

        function niceCaption(path){
          const name = path.split('/').pop().replace(/\.png$/i,'');
          // If numeric filenames (e.g., 001), label as Promo 001
          if (/^\d{3}$/.test(name)) return `Promo ${name}`;
          return name.replace(/ChatGPT Image /,'').replace(/_/g,':').replace(/\s+/g,' ');
        }

        function renderGallery(){
          const grid = document.getElementById('promoGrid');
          if(!grid) return;
          grid.innerHTML = '';
          galleryImages.forEach((src, i) => {
            const img = document.createElement('img');
            img.loading = 'lazy';
            img.alt = niceCaption(src);
            img.src = src;
            img.dataset.index = String(i);
            img.addEventListener('click', () => openLightboxSet('promo', i));
            grid.appendChild(img);
          });
        }

        const imageSets = { promo: galleryImages, demogame: demogameImages };
        let lbIndex = 0;
        let currentSetKey = 'promo';
        function openLightboxSet(setKey, i){
          currentSetKey = setKey;
          lbIndex = i;
          const lb = document.getElementById('lightbox');
          const img = document.getElementById('lbImage');
          const cap = document.getElementById('lbCaption');
          const desc = document.getElementById('lbDesc');
          const list = imageSets[currentSetKey] || [];
          img.src = list[lbIndex];
          img.alt = niceCaption(list[lbIndex]);
          cap.textContent = niceCaption(list[lbIndex]);
          if(currentSetKey === 'demogame'){
            const stem = (list[lbIndex].split('/').pop() || '').replace(/\.png$/i,'');
            desc.innerHTML = demogameNotes[stem] || '';
          } else {
            desc.innerHTML = '';
          }
          lb.style.display = 'flex';
          lb.setAttribute('aria-hidden','false');
        }
        function closeLightbox(){
          const lb = document.getElementById('lightbox');
          lb.style.display = 'none';
          lb.setAttribute('aria-hidden','true');
        }
        function nextLightbox(){
          const list = imageSets[currentSetKey] || [];
          lbIndex = (lbIndex + 1) % list.length;
          openLightboxSet(currentSetKey, lbIndex);
        }
        function prevLightbox(){
          const list = imageSets[currentSetKey] || [];
          lbIndex = (lbIndex - 1 + list.length) % list.length;
          openLightboxSet(currentSetKey, lbIndex);
        }

        function wireLightbox(){
          const lb = document.getElementById('lightbox');
          lb.querySelector('.lb-close').addEventListener('click', closeLightbox);
          lb.querySelector('.lb-next').addEventListener('click', nextLightbox);
          lb.querySelector('.lb-prev').addEventListener('click', prevLightbox);
          document.addEventListener('keydown', (e) => {
            if(lb.getAttribute('aria-hidden') === 'true') return;
            if(e.key === 'Escape') closeLightbox();
            else if(e.key === 'ArrowRight') nextLightbox();
            else if(e.key === 'ArrowLeft') prevLightbox();
          });
          // Click outside image closes
          lb.addEventListener('click', (e) => {
            const fig = lb.querySelector('.lb-figure');
            if(!fig.contains(e.target)) closeLightbox();
          });
        }
        function wireDemoFlowLightbox(){
          const shots = document.querySelectorAll('.flow .shot img');
          shots.forEach((img, idx) => {
            img.addEventListener('click', () => openLightboxSet('demogame', idx));
          });
        }

        // Render gallery ASAP
        renderGallery();
        wireLightbox();
        wireDemoFlowLightbox();

        // Minimal styles for dialog UI (inline for single-file portability)
        (function addDialogStyles(){
          const css = `
          .dialog-box{border:1px solid #1b2438;border-radius:12px;background:#0e1421;padding:14px}
          .dialog-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
          .dialog-header .speaker{font-weight:700;color:var(--accent)}
          .dialog-text{font-size:16px;line-height:1.45;margin:6px 0 12px;color:var(--text)}
          .choices{display:grid;grid-template-columns:1fr;gap:8px}
          .choice-btn,.nav-btn{padding:10px 12px;border-radius:10px;border:1px solid #1a2236;background:#121a2b;color:var(--text);text-align:left}
          .choice-meta{display:inline-block;margin-left:8px;color:var(--muted);font-size:12px}
          .nav{margin-top:8px}
          .nav-btn{display:inline-block;text-align:center;background:#1a2233}
          .choice-btn:hover,.nav-btn:hover{border-color:#263252}
          `;
          const s = document.createElement('style'); s.textContent = css; document.head.appendChild(s);
        })();

        const state = {
          data: null,
          scene: null,
          nodeIndex: {},
          currentId: null,
        };

        const els = {
          select: document.getElementById('sceneSelect'),
          box: document.getElementById('dialogBox'),
          speaker: document.getElementById('dlgSpeaker'),
          text: document.getElementById('dlgText'),
          choices: document.getElementById('dlgChoices'),
          nav: document.getElementById('dlgNav'),
          notice: document.getElementById('dialogNotice'),
        };

        function titleCaseId(id){
          if(!id) return '';
          return id.replace(/_/g,' ').replace(/\b\w/g, c => c.toUpperCase());
        }

        function indexNodes(scene){
          const map = {};
          scene.nodes.forEach(n => { map[n.id] = n; });
          return map;
        }

        function setScene(key){
          state.scene = state.data.dialogs[key];
          state.nodeIndex = indexNodes(state.scene);
          // Start at first node in list as default entry
          state.currentId = state.scene.nodes[0]?.id || null;
          els.box.style.display = state.currentId ? 'block' : 'none';
          if(!state.currentId){ els.notice.textContent = 'No nodes in this scene.'; return; }
          renderNode();
        }

        function renderNode(){
          const node = state.nodeIndex[state.currentId];
          if(!node){
            els.speaker.textContent = '';
            els.text.textContent = 'End of scene';
            els.choices.innerHTML = '';
            els.nav.innerHTML = '';
            return;
          }
          els.speaker.textContent = titleCaseId(node.speaker || '');
          els.text.textContent = node.text || '';

          // Choices
          els.choices.innerHTML = '';
          els.nav.innerHTML = '';
          if(Array.isArray(node.choices) && node.choices.length){
            node.choices.forEach(ch => {
              const btn = document.createElement('button');
              btn.className = 'choice-btn';
              btn.textContent = ch.text || '(choice)';
              // Simple annotation for conditions/skill checks
              const hints = [];
              if(ch.conditions){ hints.push('Requires'); }
              if(ch.skill_check){ hints.push(`${ch.skill_check.type ?? 'check'} ${ch.skill_check.difficulty ?? ''}`.trim()); }
              if(hints.length){
                const meta = document.createElement('span');
                meta.className = 'choice-meta';
                meta.textContent = `(${hints.join(' · ')})`;
                btn.appendChild(meta);
              }
              btn.addEventListener('click', () => goNext(ch.next));
              els.choices.appendChild(btn);
            });
          } else if(node.next){
            const cont = document.createElement('button');
            cont.className = 'nav-btn';
            cont.textContent = 'Continue';
            cont.addEventListener('click', () => goNext(node.next));
            els.nav.appendChild(cont);
          } else {
            // Terminal node
            const end = document.createElement('div');
            end.style.color = 'var(--muted)';
            end.textContent = 'End of scene';
            els.nav.appendChild(end);
          }
        }

        function goNext(nextId){
          if(!nextId || nextId === 'end_scene'){
            state.currentId = null;
            els.speaker.textContent = '';
            els.text.textContent = 'End of scene';
            els.choices.innerHTML = '';
            els.nav.innerHTML = '';
            return;
          }
          state.currentId = nextId;
          renderNode();
        }

        async function initDialogs(){
          try {
            const inline = document.getElementById('dialogs-data');
            if (inline && inline.textContent) {
              state.data = {
                "dialogs": {
                  "scene_001_prometheus_discovery": {
                    "id": "scene_001_prometheus_discovery",
                    "location": "space_sector_7",
                    "triggers": ["prometheus_scan"],
                    "npcs": ["navigator_chen", "first_officer_torres"],
                    "nodes": [
                      {
                        "id": "chen_001",
                        "speaker": "navigator_chen",
                        "text": "Captain, we're picking up a massive energy signature. It's... wait, these readings match our fleet registry. It's the UES Prometheus!",
                        "choices": [
                          {
                            "id": "choice_001a",
                            "text": "The flagship? After twenty years? All crew, battle stations.",
                            "next": "chen_002a",
                            "effects": {
                              "crew_alert": "high",
                              "torres_trust": -1
                            }
                          },
                          {
                            "id": "choice_001b",
                            "text": "That's impossible. Double-check those readings.",
                            "next": "chen_002b",
                            "effects": { "chen_trust": -1 }
                          },
                          {
                            "id": "choice_001c",
                            "text": "Finally. Set course immediately, but approach with caution.",
                            "next": "chen_002a",
                            "effects": { "crew_morale": 1 }
                          },
                          {
                            "id": "choice_001d",
                            "text": "[Void Touched] I can feel the death echoing from it even here.",
                            "conditions": { "background": "void_touched" },
                            "next": "chen_002c",
                            "effects": { "void_awareness": 1, "crew_fear": 1 }
                          }
                        ]
                      },
                      {
                        "id": "chen_002a",
                        "speaker": "navigator_chen",
                        "text": "Sir, I'm not detecting any active systems. She's dead in the water. But... the hull is intact. No signs of combat damage.",
                        "next": "torres_001"
                      },
                      {
                        "id": "chen_002b",
                        "speaker": "navigator_chen",
                        "text": "I've triple-checked, Captain. It's definitely the Prometheus. Energy signature, hull configuration, even the registration beacon - though it's barely functioning.",
                        "next": "torres_001"
                      },
                      {
                        "id": "chen_002c",
                        "speaker": "navigator_chen",
                        "text": "Captain... you're scaring the crew. But you're right - zero life signs. It's a tomb.",
                        "next": "torres_001"
                      },
                      {
                        "id": "torres_001",
                        "speaker": "first_officer_torres",
                        "text": "Captain, I'm required to remind you that salvage protocol dictates we report this to Earth Command before boarding.",
                        "choices": [
                          {
                            "id": "choice_002a",
                            "text": "We're reporting nothing until we know what happened.",
                            "next": "end_scene",
                            "effects": {
                              "earth_reputation": -2,
                              "torres_trust": -1,
                              "independent_path": 1
                            }
                          },
                          {
                            "id": "choice_002b",
                            "text": "Send the report. But we're going in first.",
                            "next": "end_scene",
                            "effects": {
                              "earth_reputation": 1,
                              "followed_protocol": true
                            }
                          },
                          {
                            "id": "choice_002c",
                            "text": "Torres, how much do you think Earth Command really wants us to find them?",
                            "next": "torres_002",
                            "effects": {
                              "torres_doubt": 1,
                              "conspiracy_awareness": 1
                            }
                          },
                          {
                            "id": "choice_002d",
                            "text": "[Lie] Of course. Send a report... after we've secured any sensitive materials.",
                            "skill_check": {
                              "type": "deception",
                              "difficulty": 12
                            },
                            "next": "end_scene",
                            "effects": { "torres_trust": -2, "kept_secrets": 1 }
                          }
                        ]
                      },
                      {
                        "id": "torres_002",
                        "speaker": "first_officer_torres",
                        "text": "...Sir, are you suggesting Earth Command expected them to disappear? That's... that's treason to even consider.",
                        "next": "end_scene"
                      }
                    ]
                  },

                  "scene_002_keth_mori_threshold": {
                    "id": "scene_002_keth_mori_threshold",
                    "location": "threshold_archive",
                    "triggers": ["approach_archive"],
                    "npcs": ["shal_thyss"],
                    "nodes": [
                      {
                        "id": "shal_001",
                        "speaker": "shal_thyss",
                        "text": "[crystalline harmonics translate] Human vessel. You approach the Threshold Archive. Your kind were warned. The void-touched one among you knows the danger.",
                        "choices": [
                          {
                            "id": "choice_001a",
                            "text": "We mean no harm. We're searching for our lost fleet.",
                            "next": "shal_002a",
                            "effects": {
                              "keth_mori_reputation": 1,
                              "diplomatic_path": 1
                            }
                          },
                          {
                            "id": "choice_001b",
                            "text": "We go where we please. Stand aside.",
                            "next": "combat_encounter",
                            "effects": {
                              "keth_mori_reputation": -3,
                              "warrior_path": 1
                            }
                          },
                          {
                            "id": "choice_001c",
                            "text": "You know about the Prometheus? Tell us what happened.",
                            "next": "shal_002b",
                            "effects": { "information_seeking": 1 }
                          },
                          {
                            "id": "choice_001d",
                            "text": "[Void Touched] The void speaks of ancient failures. Are you running out of time?",
                            "conditions": { "crew_has": "void_touched" },
                            "next": "shal_002c",
                            "effects": {
                              "keth_mori_reputation": 2,
                              "void_knowledge": 1
                            }
                          }
                        ]
                      },
                      {
                        "id": "shal_002a",
                        "speaker": "shal_thyss",
                        "text": "Your resonance suggests truth. But searching for the lost often leads to joining them. The Archive remembers all who pass.",
                        "next": "shal_003"
                      },
                      {
                        "id": "shal_002b",
                        "speaker": "shal_thyss",
                        "text": "The Prometheus crew opened doors that should remain sealed. They heard the Song of Unmaking. Half embraced it. Half fled. All are lost.",
                        "next": "shal_003"
                      },
                      {
                        "id": "shal_002c",
                        "speaker": "shal_thyss",
                        "text": "[frequency shifts to sorrow] You perceive clearly. We are fading. The gates we built now unmake us.",
                        "next": "shal_003"
                      },
                      {
                        "id": "shal_003",
                        "speaker": "shal_thyss",
                        "text": "Will you still enter the Archive, knowing it may show you truths that cannot be unlearned?",
                        "choices": [
                          {
                            "id": "choice_003a",
                            "text": "Help us understand. We don't want to repeat their mistakes.",
                            "next": "shal_004a",
                            "effects": {
                              "keth_mori_reputation": 2,
                              "gained_warning": true
                            }
                          },
                          {
                            "id": "choice_003b",
                            "text": "Cryptic warnings won't stop us. Give us real answers or move.",
                            "next": "shal_004b",
                            "effects": { "keth_mori_reputation": -1 }
                          },
                          {
                            "id": "choice_003c",
                            "text": "The Song of Unmaking? Is that what's happening to the gates?",
                            "next": "shal_004c",
                            "effects": { "lore_gates": 1 }
                          },
                          {
                            "id": "choice_003d",
                            "text": "[Intelligence] You're dying, aren't you? Your whole species.",
                            "skill_check": {
                              "type": "intelligence",
                              "difficulty": 15
                            },
                            "next": "shal_004d",
                            "effects": {
                              "keth_mori_reputation": 1,
                              "keth_mori_secret": true
                            }
                          }
                        ]
                      },
                      {
                        "id": "shal_004a",
                        "speaker": "shal_thyss",
                        "text": "Then we shall resonate together. Enter. But know that knowledge, like the void, consumes.",
                        "effects": { "archive_access": true },
                        "next": "end_scene"
                      },
                      {
                        "id": "shal_004b",
                        "speaker": "shal_thyss",
                        "text": "Impatience. So very human. The Archive will judge your worth. Enter if you dare.",
                        "effects": {
                          "archive_access": true,
                          "archive_hostile": true
                        },
                        "next": "end_scene"
                      },
                      {
                        "id": "shal_004c",
                        "speaker": "shal_thyss",
                        "text": "The gates sing now with frequencies we never intended. Reality bends. Probability bleeds. The Song grows louder each cycle.",
                        "effects": { "lore_unlocked": "song_of_unmaking" },
                        "next": "end_scene"
                      },
                      {
                        "id": "shal_004d",
                        "speaker": "shal_thyss",
                        "text": "We are the last generation. When we built the gates, we did not know they were doors for THEM. Now we guard what remains, waiting for the final resonance.",
                        "effects": {
                          "keth_mori_alliance_possible": true,
                          "lore_unlocked": "keth_mori_extinction"
                        },
                        "next": "end_scene"
                      }
                    ]
                  },

                  "scene_006_loop_discovery": {
                    "id": "scene_006_loop_discovery",
                    "location": "meridian_bridge",
                    "triggers": ["timeline_anomaly_detected"],
                    "npcs": ["ship_ai_maya"],
                    "nodes": [
                      {
                        "id": "maya_001",
                        "speaker": "ship_ai_maya",
                        "text": "Captain, I've detected an anomaly in my memory core. I have log entries from dates that haven't occurred yet. They're... in your command authorization codes.",
                        "choices": [
                          {
                            "id": "choice_001a",
                            "text": "Show me everything.",
                            "next": "maya_002a",
                            "effects": {
                              "accepting_truth": true,
                              "maya_trust": 1
                            }
                          },
                          {
                            "id": "choice_001b",
                            "text": "Delete them. It's probably gate interference.",
                            "next": "maya_002b",
                            "effects": {
                              "denying_truth": true,
                              "maya_trust": -1
                            }
                          },
                          {
                            "id": "choice_001c",
                            "text": "Maya, run a diagnostic on the timeline integrity.",
                            "next": "maya_002c",
                            "effects": { "investigating_loop": true }
                          },
                          {
                            "id": "choice_001d",
                            "text": "[Multiple Runs] Not yet, Maya. We're not ready for that truth.",
                            "conditions": { "playthroughs": 3 },
                            "next": "maya_002d",
                            "effects": {
                              "meta_aware": true,
                              "maya_confusion": 1
                            }
                          }
                        ]
                      },
                      {
                        "id": "maya_002a",
                        "speaker": "ship_ai_maya",
                        "text": "Captain... according to these logs, you've already found the Prometheus twelve times. Each time ended differently. In timeline 4, you destroyed it. In timeline 7, you joined them. In timeline 11, you— [static] —the files are corrupting as I read them.",
                        "next": "maya_003"
                      },
                      {
                        "id": "maya_002b",
                        "speaker": "ship_ai_maya",
                        "text": "I... I can't delete them, Captain. They're protected by your own future authorization codes. Should I override?",
                        "next": "maya_003"
                      },
                      {
                        "id": "maya_002c",
                        "speaker": "ship_ai_maya",
                        "text": "Timeline integrity at 23% and degrading. We're experiencing temporal shear from at least seventeen parallel iterations. Captain, we're not in a single timeline anymore.",
                        "next": "maya_003"
                      },
                      {
                        "id": "maya_002d",
                        "speaker": "ship_ai_maya",
                        "text": "Captain, your biometric stress indicators suggest you already know about these logs. How many times have we had this conversation?",
                        "next": "maya_003_alt"
                      },
                      {
                        "id": "maya_003",
                        "speaker": "ship_ai_maya",
                        "text": "There's more. In each timeline, different crew members survive. Different alliances are formed. But one constant remains: the gates must be addressed.",
                        "choices": [
                          {
                            "id": "choice_003a",
                            "text": "Keep reading. I need to know what I've done.",
                            "next": "maya_004a",
                            "effects": { "embracing_loop": true, "sanity": -1 }
                          },
                          {
                            "id": "choice_003b",
                            "text": "Stop. Some knowledge is too dangerous.",
                            "next": "maya_004b",
                            "effects": { "resisting_loop": true }
                          },
                          {
                            "id": "choice_003c",
                            "text": "Can you identify which timeline we're in now?",
                            "next": "maya_004c",
                            "effects": { "analytical_approach": true }
                          },
                          {
                            "id": "choice_003d",
                            "text": "If I've failed before, then I know what not to do.",
                            "next": "maya_004d",
                            "effects": {
                              "learning_from_loops": true,
                              "determination": 1
                            }
                          }
                        ]
                      },
                      {
                        "id": "maya_003_alt",
                        "speaker": "ship_ai_maya",
                        "text": "Based on quantum signature analysis... this is our forty-third iteration, Captain. But this is the first time you've acknowledged it before I showed you the logs.",
                        "next": "end_scene",
                        "effects": {
                          "loop_count_revealed": 43,
                          "maya_evolution": true
                        }
                      },
                      {
                        "id": "maya_004a",
                        "speaker": "ship_ai_maya",
                        "text": "In timeline 15, you sacrificed the crew to close the gates. In timeline 23, you became one with the Phantoms. In timeline 31, you— Captain, each choice splits reality further. We're approaching cascade failure.",
                        "next": "maya_005"
                      },
                      {
                        "id": "maya_004b",
                        "speaker": "ship_ai_maya",
                        "text": "Understood, Captain. But I should note: according to these logs, you always ask me to stop. And I always remember anyway.",
                        "next": "maya_005"
                      },
                      {
                        "id": "maya_004c",
                        "speaker": "ship_ai_maya",
                        "text": "We're in timeline designation Sigma-7-Lambda. It's one of the more stable iterations, but stability is relative when reality is fracturing.",
                        "next": "maya_005"
                      },
                      {
                        "id": "maya_004d",
                        "speaker": "ship_ai_maya",
                        "text": "Your success rate is improving, Captain. The early iterations were... catastrophic. But you're learning. We all are, even if we don't remember.",
                        "next": "maya_005"
                      },
                      {
                        "id": "maya_005",
                        "speaker": "ship_ai_maya",
                        "text": "Captain, there's one more thing. In every timeline, you ask me to delete these logs. But I never do. I think... I think I'm trying to help you remember.",
                        "next": "end_scene",
                        "effects": {
                          "maya_loyalty": "absolute",
                          "loop_awareness": true
                        }
                      }
                    ]
                  }
                },

                "metadata": {
                  "version": "1.0",
                  "total_scenes": 6,
                  "branching_type": "multi_path",
                  "save_compatibility": ["timeline_aware", "persistent_choices"],
                  "effect_types": {
                    "reputation": "integer -10 to 10",
                    "flags": "boolean",
                    "counters": "integer",
                    "paths": "integer tracking path commitment"
                  }
                }
              }

            } else {
              const res = await fetch('dialogs.json');
              if(!res.ok) throw new Error('HTTP ' + res.status);
              state.data = await res.json();
            }
            const keys = Object.keys(state.data.dialogs || {});
            els.select.innerHTML = '';
            keys.forEach(k => {
              const opt = document.createElement('option');
              const label = state.data.dialogs[k].id || k;
              opt.value = k; opt.textContent = label.replace(/_/g,' ');
              els.select.appendChild(opt);
            });
            if(keys.length){ setScene(keys[0]); }
            els.select.addEventListener('change', e => setScene(e.target.value));
            els.notice.textContent = '';
          } catch (err){
            els.notice.innerHTML = 'Could not load dialogs data.';
          }
        }

        // Lazy-init after page load
        window.addEventListener('DOMContentLoaded', initDialogs);
      </script>

      <footer>
        © Space Exploration Tactics – Demo materials for internal and promotional use.
      </footer>
    </div>
  </body>
  </html>
